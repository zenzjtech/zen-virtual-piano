# i18n Implementation Plan for Zen Virtual Piano

## Overview

The extension has **250+ user-facing text strings** across:
- UI Components (buttons, labels, tooltips)
- Dialogs and notifications
- Settings panels
- Music sheet metadata
- Chrome Web Store listing
- Onboarding flows

## Recommended Approach: react-i18next ⭐

**Why react-i18next:**
- Better DX with hooks (`useTranslation`)
- Dynamic language switching
- Rich ecosystem and tooling
- TypeScript support
- Future-proof for multiple languages
- Better integration with React components

**Trade-offs:**
- Additional dependency (~50KB)
- Requires more setup in extension context

## Proposed Implementation Plan

### **Phase 1: Foundation Setup** (Impact: Large, Risk: Low)

#### 1.1 Install Dependencies (if using react-i18next)
```bash
yarn add i18next react-i18next i18next-browser-languagedetector
yarn add -D @types/i18next
```

#### 1.2 Create i18n Infrastructure
**Location:** `src/lib/i18n/`
```
src/lib/i18n/
├── index.ts              # i18n initialization & config
├── locales/
│   ├── en/
│   │   ├── common.json       # Common UI strings
│   │   ├── piano.json        # Piano-specific strings
│   │   ├── sheet.json        # Music sheet strings
│   │   ├── settings.json     # Settings strings
│   │   └── notifications.json # Notification messages
│   └── ja/
│       ├── common.json
│       ├── piano.json
│       ├── sheet.json
│       ├── settings.json
│       └── notifications.json
└── types.ts              # Translation key types
```

#### 1.3 Create i18n Redux Slice
**Location:** `src/store/reducers/i18n-slice.ts`
- Store current locale preference
- Persist via redux-chrome-storage
- Default to browser language or 'en'

#### 1.4 Create Custom Hook
**Location:** `src/hooks/use-translation.ts`
```typescript
export const useTranslation = (namespace?: string) => {
  const locale = useAppSelector(state => state.i18n.locale);
  const t = (key: string, options?: object) => { /* ... */ };
  return { t, locale };
};
```

### **Phase 2: Content Translation** (Impact: Large, Risk: Medium)

#### 2.1 Extract All Hardcoded Strings
Create translation keys for:

**Common UI (`common.json`):**
- Button labels: "Cancel", "Save", "Delete", "Close", "Apply"
- Actions: "Clear Filters", "Sort", "Search", "Add", "Remove"
- General: "Favorites", "Recently Played", "All Sheets"

**Piano Module (`piano.json`):**
- Instruments: "Grand Piano", "Classical Piano", "Organ", etc.
- Controls: "Record", "Play", "Stop", "Sustain", "Metronome"
- Themes: Theme names and descriptions
- Keyboard shortcuts

**Music Sheet (`sheet.json`):**
- Dialog titles: "Add Sheet", "Delete Sheet", "Go to Page"
- Form labels: "Title", "Artist", "Difficulty", "Notation"
- Difficulty levels: "Easy", "Medium", "Hard"
- Sort options: "Title (A-Z)", "Artist (A-Z)", "Difficulty", "Recently Added"
- Messages: "No sheets found", "Search Results"

**Settings (`settings.json`):**
- Tabs: "General", "Piano", "Keyboard", "Quotes"
- Labels and descriptions for all settings

**Notifications (`notifications.json`):**
- Success/error messages
- Welcome messages
- Tips and hints

#### 2.2 Priority Components for Initial Translation
1. **Header** (`src/components/header/`) - Most visible
2. **Piano Controls** (`src/components/piano/settings-bar.tsx`)
3. **Sheet Search** (`src/components/music-sheet/sheet-search-dialog.tsx`)
4. **User Menu** (`src/components/header/user-menu.tsx`)
5. **Settings Dialog** (`src/components/settings/settings-dialog.tsx`)

### **Phase 3: Integration** (Impact: Medium, Risk: Medium)

#### 3.1 Update Components
Replace hardcoded strings with translation calls:
```tsx
// Before
<Button>Clear Filters</Button>

// After (react-i18next)
const { t } = useTranslation('common');
<Button>{t('clearFilters')}</Button>
```

#### 3.2 Update Redux Slices
Translate default values and enums

#### 3.3 Update Notification System
Add translation support to `NotificationContext`

### **Phase 4: Chrome Web Store Localization** (Impact: Small, Risk: Low)

#### 4.1 Create Localized Store Listings
**Location:** `docs/cws/store-listing/`
```
docs/cws/store-listing/
├── en/
│   └── description.md
└── ja/
    └── description.md
```

#### 4.2 Translate Extension Manifest
Update `wxt.config.ts` to support localized names/descriptions

### **Phase 5: Language Switcher UI** (Impact: Small, Risk: Low)

#### 5.1 Add Language Selector
**Location:** Settings dialog or Header
- Dropdown with language options
- Flag icons (optional)
- Persist selection in Redux

### **Phase 6: Japanese Translation** (Impact: Large, Risk: Low)

#### 6.1 Professional Translation
- Hire native Japanese translator OR
- Use AI translation + native review
- Focus on cultural appropriateness

#### 6.2 Translation Guidelines
- Maintain technical accuracy
- Use appropriate formality level (polite/casual)
- Consider character width for UI layout
- Test with Japanese fonts

### **Phase 7: Testing & QA** (Impact: Medium, Risk: Medium)

#### 7.1 Functional Testing
- Language switching works
- All strings translated
- No missing keys
- Fallback to English works

#### 7.2 Visual Testing
- Japanese text fits in UI
- No layout breaking
- Font rendering correct
- RTL not needed (Japanese is LTR)

#### 7.3 E2E Testing
- Full user flows in Japanese
- Settings persistence
- Extension reload behavior

## Implementation Timeline

| Phase | Description | Estimated Effort | Risk Level |
|-------|-------------|-----------------|------------|
| 1 | Foundation Setup | 4-6 hours | Low |
| 2 | Content Translation | 8-12 hours | Medium |
| 3 | Integration | 12-16 hours | Medium |
| 4 | CWS Localization | 2-3 hours | Low |
| 5 | Language Switcher | 3-4 hours | Low |
| 6 | Japanese Translation | 8-16 hours | Low |
| 7 | Testing & QA | 6-8 hours | Medium |
| **Total** | **43-65 hours** | **Medium** |

## Suggested Commit Names

Following your commit convention:

1. **feat(i18n): initialize i18n infrastructure with react-i18next**
2. **feat(i18n): add translation keys for common UI components**
3. **feat(i18n): integrate translations in piano and sheet modules**
4. **feat(i18n): add Japanese translations for core UI**
5. **feat(i18n): implement language switcher in settings**

## Implementation Readiness

### Prerequisites
- ✅ i18n.md plan created
- ⏳ Dependencies installed
- ⏳ i18n infrastructure set up
- ⏳ Translation keys extracted

### Next Steps
Ready to begin Phase 1 implementation:
1. **Install react-i18next dependencies**
2. **Create i18n infrastructure** (`src/lib/i18n/`)
3. **Set up Redux slice** for locale management
4. **Create translation hook** (`useTranslation`)

Would you like to start with Phase 1 implementation?
